---
pagetitle: Baleia Franca
output:
  html_document:
    pandoc_args: [
      "--number-offset= 0"]
    toc: yes
    toc_float: true
    number_sections: true
    code_folding: "show"
editor_options: 
  markdown: 
    wrap: 72
---

```{=html}
<style>
body {
text-align: justify}
</style>
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Ocorrências da Baleia Franca Austral

As baleias francas (*Eubalaena australis*) podem ser facilmente
distinguidas dos outros grandes cetáceos por várias características. A
principal delas é a ausência da nadadeira dorsal, característica
exclusiva dentre as baleias que habitam o Hemisfério Sul. Possuem os
orifícios respiratórios bastante separados, originando um vapor
característico em forma de "V" durante a respiração (CUMMINGS, 1985;
EVANS, 1987). Além disso, esta espécie apresentam diversas calosidades
ou "verrugas" na região da cabeça, as quais são utilizadas como
principal caracteristica de identificação destes individuos, pois cada
individuo apresenta um padrão diferente.


<center>
![](imagens/whale_main.jpg){width="648"}
</center>


Esta espécie apresenta dimorfismo sexual, sendo as fêmeas maiores que os
machos, podendo chegar a 18 metros de comprimento e pesando até 56
toneladas. O período de gestação é de 11 a 12 meses, no qual as fêmeas
tem em média um filhote a cada três anos. Os filhotes nascem com cerca
de 6 metros e pesando 4 a 5 toneladas.

Assim como outras espécies de Mysticetos, *Eubalaena australis* realizam
movimentos de migrações durante o ano, passando o verão na região do
polo Sul se alimentando e migrando para águas mais quentes durante o
inverno, principalmente para desenvolverem atividades de acasalamento e
procriação. Importante ressaltar que esta espécie tem ocorrência
registradas em toda a área do Hemisfério Sul. Já no Hemisfério Norte
tem-se a ocorrência da espécie *Eubalaena glacialis,* a qual sofre
diversos impactos de origem antrópica.

# Coleta de dados da Base OBIS

Iniciamos instalando os pacotes `dplyr`, `tidyverse` e `robis`. Em
seguida, iniciou-se o download das ocorrências e demais informações
sobre a espécie *E. australis*. Por meio da função `occurrence` fez-se a
busca simples das ocorrências da espécie no repositório OBIS.
```{r pacot}
## carregar pacotes
library(dplyr)
library(tidyverse)
library(robis)

```

Em seguida, os dados foram coletados **17.131** observações com 127
variáveis.
```{r ocorr}
# baixar ocorrências
franca_obis <- robis::occurrence("Eubalaena australis")
#Retrieved 17131 records of approximately 17131 (100%)

```


```{r dados}

# checar dados
names(franca_obis)
```

# Problemas encontrados nos dados

Os dados disponíveis em repositórios abertos são repletos de dados oriundos de diversas fontes. Algumas vezes os coletores não conseguem capturar as informações de forma completa ou ocorrem alguns erros inerentes a coleta ou inserção destes dados nos repositórios.

Devido a elevada quantidade de informações se faz necessária a seleção das variáveis que possam ser utilizadas para a análise. Nesse sentido, foram selecionadas as seguintes variáveis: **scientificName, decimalLatitude, decimalLongitude, bathymetry, flags, waterBody, basisOfRecord, occurrenceStatus, rightsHolder,datasetName, recordedBy, depth, locality, date_year, individualCount, year, sex**.  
```{r var}
##Selecionar variáveis
franca_obis1 <- franca_obis %>% 
  dplyr::select(scientificName, decimalLatitude, decimalLongitude, bathymetry,
                flags, waterBody, basisOfRecord, occurrenceStatus, rightsHolder,
                datasetName, recordedBy, depth, locality, date_year, individualCount, year, sex) %>%
  distinct()
```

Desse modo, os dados foram reduzidos a **12.136** observações dentre as 17 variáveis selecionadas. A fim de manter-se a qualidade das informações, precisamos verificar os possiveis problemas com os dados. Importante observar que neste repositório os problemas reportados são denominados de `flags`.
```{r flags}

# check problemas reportados (flags)
franca_obis1 %>% 
  distinct(flags)
```

```{r dataset}
#check NA em datasetName
franca_obis1 %>% 
  filter(!flags %in% c("ON_LAND,NO_DEPTH", "no_depth,on_land", "depth_exceeds_bath,on_land", "on_land,no_depth", "on_land", "on_land,depth_exceeds_bath", "ON_LAND", "ON_LAND,DEPTH_EXCEEDS_BATH"),
         is.na(datasetName)) %>% 
  distinct(waterBody)
```

As `flags` foram utilizadas para filtrar ocorrências da nossa espécie em terra e remover do nosso conjunto de dados os dataset que não apresentaram informações (NA). Além disso, aplicamos um filtro para remover a duplicidade de ocorrências e plotamos um gráfico verificando uma linha do tempo dos relatos da baleia franca austral:
```{r depht}
#depth ok
franca_obis1 %>% 
  filter(!flags %in% c("ON_LAND,NO_DEPTH", "no_depth,on_land", "depth_exceeds_bath,on_land", "on_land,no_depth", "on_land", "on_land,depth_exceeds_bath", "ON_LAND", "ON_LAND,DEPTH_EXCEEDS_BATH"),
         !is.na(datasetName),
         !waterBody %in% c("world","Global,French EEZ")) %>%
  ggplot(aes(x = date_year, fill = waterBody)) +
  geom_histogram() 

  # checar niveis
  franca_obis1 %>% 
    filter(!flags %in% c("ON_LAND,NO_DEPTH","no_depth,on_land","depth_exceeds_bath,on_land","on_land,no_depth", "on_land", "on_land,depth_exceeds_bath", "ON_LAND", "ON_LAND,DEPTH_EXCEEDS_BATH"),
           !is.na(datasetName),
           !waterBody %in% c("world","Global,French EEZ")) %>% 
    lapply(., unique)
```

```{r filtro}
# filtro final
franca_obis2 <- franca_obis1 %>% 
  filter(!flags %in% c("ON_LAND,NO_DEPTH","no_depth,on_land","depth_exceeds_bath,on_land","on_land,no_depth", "on_land", "on_land,depth_exceeds_bath", "ON_LAND", "ON_LAND,DEPTH_EXCEEDS_BATH"),
         !is.na(datasetName),
         !waterBody %in% c("world","Global,French EEZ"))
```

O primeiro mapa refere-se ao conjunto de dados `franca_obis1`, antes da aplicação do filtro final e remoção das `flags`sinalizadas. 
```{r mapa 1}
# baixar mapa do mundo
world <- map_data('world')

# plotar mapa franca obis 1
ggplot() +
  geom_polygon(data = world, aes(x = long, y = lat, group = group)) +
  coord_fixed() +
  theme_classic() +
  geom_point(data = franca_obis1, aes(x = decimalLongitude, y = decimalLatitude, color = waterBody)) +
  #theme(legend.title = element_blank()) +
  labs(x = "longitude", y = "latitude", title = expression(italic("Eubalaena australis")))
```

O segundo mapa contém menos observações (1020) e apresenta uma ocorrência mais pontual dos especimes ao longo do Hemisfério Sul. 
```{r mapa 2}
# plotar mapa franca obis 2
ggplot() +
  geom_polygon(data = world, aes(x = long, y = lat, group = group)) +
  coord_fixed() +
  theme_classic() +
  geom_point(data = franca_obis2, aes(x = decimalLongitude, y = decimalLatitude, color = waterBody)) +
  #theme(legend.title = element_blank()) +
  labs(x = "longitude", y = "latitude", title = expression(italic("Eubalaena australis")))
```

# Aplicação de gráficos interativos

Os gráficos interativos permitem uma melhor observação dos pontos de ocorrência, além de se apresentar como um atrativo a mais para o site. Para se utilizar esta funcionalidade deve-se carregar o pacote `leaflet`
```{r packge}
library(leaflet)
```

```{r mapa inter}

# conferir no mapa
franca_obis2 %>% 
  leaflet() %>% 
  addTiles() %>% 
  addMarkers(~decimalLongitude,
             ~decimalLatitude)
```

Observando no mapa anterior quase não vi ocorrencias na região da APA da Baleia Franca em Santa Catarina. Farei a seguir um mapa com os dados antes da aplicação do ultimo filtro:
OBS: O mapa sem a aplicação do filtro continha muitos dados o que tornou o grafico interativo muito pesado, desse modo tive que descarta-lo.





